<style type="text/css">
	.check_table_user_search_div {
		background-color: #fff;
		margin-left: 1%;
		margin-right: 1%;
		margin-top: 1%;
		margin-bottom: 1%;
		border: 1px solid #a8a3a3;
	}

	.check_table_user_search_div div div {
		margin-top: 20px;
		margin-bottom: 20px;
	}

	.check_table_user_result_div {
		background-color: #fff;
		margin-left: 1%;
		margin-right: 1%;
		margin-top: 1%;
		border: 1px solid #a8a3a3;
	}

	/*个人中心页面*/
	#fund_info_center {
		width: 98%;
		background-color: white;
		height: auto;
		margin-left: 1%;
		margin-top: 2%;
		box-shadow: 1px 1px 5px #535A6C;
		margin-bottom: 23%;
	}

	#fund_info_center ul:first-child span {
		font-size: 30px;
		margin-right: 15px;
		background-color: #535A6C;
		padding: 7px;
		border-radius: 23px;
		color: white;
	}

	.fund_info_input {
		float: right;
		width: 75%;
		padding-left: 0px;
		height: 31px;
		border: 1px solid #c2c2c2;
		margin-right: 15px;
	}

	.fund_info_center ul li label {
		color: #535A6C;
		font-size: 15px;
	}

	.word_spacing {
		letter-spacing: 28px;
	}

	.word_except {
		margin-right: 28px;
	}

	#fund_info_buy_id {
		/* float: right; */
		width: 76%;
	}

	#fund_info_buy_id input {
		margin-right: 5px;
	}

	#fund_info_sell_id input {
		margin-right: 5px;
	}
</style>

<div class="container-fluid check_table_user_result_div" style="padding-right: 0px;padding-left: 0px;">
	<div class="row clearfix">
		<div class="col-md-12 column">
			<table class="table table-hover table-condensed table-bordered" style="margin-top: 10px;">
				<thead style="background-color:#eeeeee;">
					<tr>
						<th style="text-align:center;">
							id
						</th>
						<th style="text-align:center;">
							基金ID
						</th>
						<th style="text-align:center;">
							基金名称
						</th>
						<th style="text-align:center;">
							份额计算方式
						</th>
						<th style="text-align:center;">
							操作
						</th>
					</tr>
				</thead>
				<tbody style="background-color: #fafafa;" id="search_normal_user_detail">

				</tbody>
			</table>
		</div>
	</div>
</div>

<div id="fund_info_center">
	<ul>
		<li style="line-height: 28px;font-size: 16px;color: #535A6C;">
			<span class="glyphicon glyphicon-user" aria-hidden="true" style="font-size: 13px;margin-right: 1px;"></span>新增基金基础信息
		</li>
		<li>
			<hr style="border-top: 1px solid #A3ADC6;" />
		</li>
		<li>
			<label class="word_except">基金ID</label>
			<input class="fund_info_input" type="text" id="fund_id" />
		</li>
		<li>
			<label class="word_except">基金名称</label>
			<input class="fund_info_input" type="text" id="fund_name" />
		</li>
		<li>
			<label class="word_except">确认份额时计算方式</label>
			<label style="float: right;width: 75%;">
				<label><input name="round_type" type="radio" value=1 />四舍五入</label>
				<label><input name="round_type" type="radio" value=0 />直接截取</label>
			</label>
		</li>
		<li>
			<label class="word_except">买入手续费规则</label>
			<div id="fund_info_buy_id">
				<input type="text" class="buy_min" placeholder="最小值" />
				<input type="text" class="buy_max" placeholder="最大值 无穷用 -1 表示" />
				<input type="text" class="buy_rate" placeholder="费率" />
				<button type="button" class="btn btn-default btn-primary" id="buy_add_botton" style="padding: 4px 13px;font-size: 12px;">+</button>
				<br />
			</div>
		</li>
		<li>
			<label class="word_except">卖出手续费规则</label>
			<div id="fund_info_sell_id">
				<input type="text" class="sell_min" placeholder="最小值" />
				<input type="text" class="sell_max" placeholder="最大值 无穷用 -1 表示" />
				<input type="text" class="sell_rate" placeholder="费率 或费用" />
				<button type="button" class="btn btn-default btn-primary" id="sell_add_botton" style="padding: 4px 13px;font-size: 12px;">+</button>
				<br />
			</div>
		</li>
		<li>
			<button type="button" class="btn btn-default btn-primary" id="fund_info_submit" style="margin-left: 16%;">新增</button>
			<label style="color: orangered;"></label>
		</li>
	</ul>
</div>

<script src="others/My97DatePicker/WdatePicker.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	function load_fund_info() {
		//进入页面后 调用接口 加载基金基础信息数据
		$.ajax({
			url: serverUrl_fund_info + "query_list",
			type: 'get',
			dataType: "json",
			data: {
				token: $.cookie('token')
			},
			success: function(data) {
				if (data.respCode == 200) {
					var result_data = data.result
					$('#search_normal_user_detail').empty();
					for (var i = 0; i < result_data.length; i++) {
						var id = result_data[i]['id'];
						var fund_id = result_data[i]['fund_id'];
						var fund_name = result_data[i]['fund_name'];
						var round_type = result_data[i]['round_type'];

						// 对 份额计算方式 进行匹配
						if (round_type == 1) {
							round_type = '<label><input name="round_type_info_' + id +
								'" type="radio" value=1 checked/>四舍五入</label>' +
								'<label><input name="round_type_info_' + id + '" type="radio" value=0 />直接截取</label>'
						} else if (round_type == 0) {
							round_type = '<label><input name="round_type_info_' + id + '" type="radio" value=1 />四舍五入</label>' +
								'<label><input name="round_type_info_' + id + '" type="radio" value=0 checked/>直接截取</label>'
						} else {
							round_type = '<label><input name="round_type_info_' + id + '" type="radio" value=1 />四舍五入</label>' +
								'<label><input name="round_type_info_' + id + '" type="radio" value=0 />直接截取</label>'
						}

						var str = '<tr><td align="center">' +
							id +
							'</td><td align="center" id="info_fund_id_' + id + '">' +
							fund_id +
							'</td><td align="center"><input class="fund_info_input" type="text" id="info_fund_name_' + id +
							'" value="' +
							fund_name + '"/>' +
							'</td><td align="center">' +
							round_type +
							'</td><td align="center">' +
							'<button type="button" id="change_button_' + id +
							'" class="btn btn-default btn-primary change_button" style="margin-left: 16%;" onclick="click_change(\'' +
							id + '\')">修改</button></label>' +
							'</td></tr>'
						$('#search_normal_user_detail').append(str);
					}
				} else {
					hide_popover('#search_normal_user_detail', data.respMsg)
				}
			},
			error: function(jqXHR, textStatus, errorThrown) {
				console.log(textStatus)
				hide_popover('#search_normal_user_detail', '程序错误')
			}
		});
	}
	load_fund_info()


	// 修改基础信息
	function click_change(id) {
		var confirm = window.confirm('此功能会修改基金基础信息,你确定吗?')
		if (confirm == true) {
			fund_id = $('#info_fund_id_' + id).text();
			var post_dict = {
				"fund_id": fund_id,
				"token": $.cookie('token')
			}
			var round_type = $("[name='round_type_info_" + id + "']:checked").val();
			if (round_type == 1 || round_type == 0) {
				post_dict['round_type'] = round_type
			}
			var fund_name = $('#info_fund_name_' + id).val();
			if (fund_name != '') {
				post_dict['fund_name'] = fund_name
				$.ajax({
					url: serverUrl_fund_info + "update",
					type: 'post',
					dataType: "json",
					data: post_dict,
					success: function(data) {
						if (data.respCode == 200) {
							hide_popover('#change_button_' + id, '修改成功')
						} else {
							hide_popover('#change_button_' + id, data.respMsg)
						}
					},
					error: function(jqXHR, textStatus, errorThrown) {
						hide_popover('#change_button_' + id, '程序错误,请联系管理员')
					}
				});
			} else {
				alert('基金名称不能为空')
			}
		}
	}

	// 买入规则 通过 点击 + 按钮 新增规则输入框
	$("#buy_add_botton").click(function() {
		$('#fund_info_buy_id').append('<input type="text" class="buy_min" placeholder="最小值" />' +
			'<input type="text" class="buy_max" placeholder="最大值 无穷用 -1 表示" />' +
			'<input type="text" class="buy_rate" placeholder="费率" />' +
			'<br/>');
	});

	// 卖出规则 通过 点击 + 按钮 新增规则输入框
	$("#sell_add_botton").click(function() {
		$('#fund_info_sell_id').append('<input type="text" class="sell_min" placeholder="最小值" />' +
			'<input type="text" class="sell_max" placeholder="最大值 无穷用 -1 表示" />' +
			'<input type="text" class="sell_rate" placeholder="费率 或费用" />' +
			'<br/>');
	});


	function get_mulit_input_val(name) {
		var val_list = new Array();
		$(name).each(function() {
			get_val = $(this).val();
			if (get_val != '') {
				val_list.push(get_val);
			}
		});
		return val_list
	}

	// 新增基金基础信息接口
	$('#fund_info_submit').on('click', function() {
		var fund_id = $('#fund_id').val();
		var fund_name = $('#fund_name').val();
		var round_type = $("[name='round_type']:checked").val();
		if (fund_id == '') {
			hide_popover('#fund_info_submit', '请输入基金ID')
			return false
		}
		if (fund_name == '') {
			hide_popover('#fund_info_submit', '请输入基金名称')
			return false
		}
		//获取买入 规则
		//最小值 list
		var buy_min_list = get_mulit_input_val('.buy_min')
		//最大值 list
		var buy_max_list = get_mulit_input_val('.buy_max')
		//费率 list
		var buy_rate_list = get_mulit_input_val('.buy_rate')
		if ((buy_min_list.length == 0) || (buy_min_list.length != buy_max_list.length) || (buy_max_list.length !=
				buy_rate_list.length)) {
			hide_popover('#fund_info_submit', '买入规则错误')
			return false
		}

		buy_handling_fee_rule = new Array();
		for (var i = 0; i < buy_min_list.length; i++) {
			rule_list = new Array(parseFloat(buy_min_list[i]), parseFloat(buy_max_list[i]), parseFloat(buy_rate_list[i]));
			buy_handling_fee_rule.push(rule_list)
		}

		//获取卖出 规则
		//最小值 list
		var sell_min_list = get_mulit_input_val('.sell_min')
		//最大值 list
		var sell_max_list = get_mulit_input_val('.sell_max')
		//费率 list
		var sell_rate_list = get_mulit_input_val('.sell_rate')
		if ((sell_min_list.length == 0) || (sell_min_list.length != sell_max_list.length) || (sell_max_list.length !=
				sell_rate_list.length)) {
			hide_popover('#fund_info_submit', '卖出规则错误')
			return false
		}

		sell_handling_fee_rule = new Array();
		for (var i = 0; i < sell_min_list.length; i++) {
			rule_list = new Array(parseFloat(sell_min_list[i]), parseFloat(sell_max_list[i]), parseFloat(sell_rate_list[i]));
			sell_handling_fee_rule.push(rule_list)
		}

		//调用接口
		$.ajax({
			url: serverUrl_fund_info + "new",
			type: 'post',
			dataType: "json",
			headers: {
				"Content-Type": "application/json;charset=UTF-8",
				"token": $.cookie('token')
			},
			data: JSON.stringify({
				fund_id: fund_id,
				fund_name: fund_name,
				buy_handling_fee_rule: buy_handling_fee_rule,
				sell_handling_fee_rule: sell_handling_fee_rule
			}),
			traditional: true,
			success: function(data) {
				if (data.respCode == 200) {
					hide_popover('#fund_info_submit', '新增成功')
				} else {
					hide_popover('#fund_info_submit', data.respMsg)
				}
			},
			error: function(jqXHR, textStatus, errorThrown) {
				console.log(textStatus)
				hide_popover('#fund_info_submit', '程序错误')
			}
		});

	})
</script>
